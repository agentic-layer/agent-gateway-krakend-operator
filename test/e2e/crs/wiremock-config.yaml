apiVersion: v1
kind: Pod
metadata:
  name: wiremock-config
spec:
  restartPolicy: Never
  containers:
  - name: curl
    image: curlimages/curl:latest
    command: ["/bin/sh", "-c"]
    args:
    - |
      curl -X POST 'http://mocked-agent:8080/__admin/mappings' \
      -H 'Content-Type: application/json' \
      -d '{
        "request": {
          "method": "POST"
        },
        "response": {
          "status": 200,
          "body": "This is a mocked response!",
          "headers": {
            "Content-Type": "text/plain"
          }
        }
      }'

      curl -X POST 'http://mocked-agent:8080/__admin/mappings' \
      -H 'Content-Type: application/json' \
      -d '{
        "request": {
          "method": "GET",
          "urlPath": "/.well-known/agent-card.json"
        },
        "response": {
          "status": 200,
          "jsonBody": {
            "name": "mocked-agent",
            "description": "A test agent for e2e tests",
            "version": "1.0.0",
            "capabilities": ["conversation", "task-execution"],
            "protocols": {
              "a2a": {
                "endpoint": "/",
                "methods": ["POST"]
              }
            },
            "metadata": {
              "author": "PAAL Team",
              "license": "Apache-2.0",
              "tags": ["test", "e2e", "mocked"]
            },
            "endpoints": [
              {
                "path": "/",
                "method": "POST",
                "description": "Main agent endpoint"
              }
            ]
          },
          "headers": {
            "Content-Type": "application/json"
          }
        }
      }'
    securityContext:
      allowPrivilegeEscalation: false
      capabilities:
        drop: ["ALL"]
      runAsNonRoot: true
      runAsUser: 1000
      seccompProfile:
        type: RuntimeDefault